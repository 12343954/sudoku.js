var SUDOKU,SOLVED,BOARD_SEL="#sudoku-board",NUMBERS_SEL="#sudoku-numbers",TABS_SEL="#generator-tabs",MESSAGE_SEL="#message",PUZZLE_CONTROLS_SEL="#puzzle-controls",IMPORT_CONTROLS_SEL="#import-controls",SOLVER_CONTROLS_SEL="#solver-controls",FAILED=!1,MUTE=!1,LABELED=!1,LEVEL={easy:"easy",medium:"medium",hard:"hard","very-hard":"very-hard",insane:"insane",inhuman:"inhuman",import:"import"},boards={[LEVEL.easy]:null,[LEVEL.medium]:null,[LEVEL.hard]:null,[LEVEL["very-hard"]]:null,[LEVEL.insane]:null,[LEVEL.inhuman]:null,[LEVEL.import]:null},build_board=function(){for(var e=0;e<9;++e){for(var t=$("<tr/>",{}),s=0;s<9;++s){var a=$("<td/>",{});s%3==2&&8!=s&&a.addClass("border-right"),a.append($("<div/>",{id:"row"+e+"-col"+s,class:"square"})),t.append(a)}e%3==2&&8!=e&&t.addClass("border-bottom"),$(BOARD_SEL).append(t)}},init_board=function(){$(BOARD_SEL+" div.square").change((function(){return!1;var e=$(this).val().length,t="40px";3===e?t="35px":4===e?t="25px":5===e?t="20px":6===e?t="17px":7===e?t="14px":8===e?t="13px":e>=9&&(t="11px"),$(this).css("font-size",t)}))},init_tabs=function(){$(TABS_SEL+" a").click((function(e){e.preventDefault(),!MUTE&&SOUND.click?.play();var t=$(this),s=t.attr("id");$(MESSAGE_SEL).hide(),"import"===s?($(PUZZLE_CONTROLS_SEL).hide(),$(IMPORT_CONTROLS_SEL).show()):($(PUZZLE_CONTROLS_SEL).show(),$(IMPORT_CONTROLS_SEL).hide()),t.tab("show"),refresh()}))},init_controls=function(){$(NUMBERS_SEL+" div").click((e=>{check_in(e.target)})),$(PUZZLE_CONTROLS_SEL+" #refresh").click((function(e){e.preventDefault(),refresh()})),$(PUZZLE_CONTROLS_SEL+" #label-puzzle").click((function(e){LABELED=!LABELED,e.preventDefault(),!MUTE&&SOUND.labeled?.play(),$(e.target).toggleClass("btn-off"),$(NUMBERS_SEL+" div").toggleClass("labeled"),LABELED||$(NUMBERS_SEL+" div.select").removeClass("select")})),$(PUZZLE_CONTROLS_SEL+" #btn-sound").click((function(e){MUTE=!MUTE,e.preventDefault(),SOUND.labeled?.play(),$(e.target).toggleClass("btn-mute")})),$(IMPORT_CONTROLS_SEL+" #import-string").change((function(){for(var e=$(this).val(),t="",s=0;s<81;++s)void 0===e[s]||!sudoku._in(e[s],sudoku.DIGITS)&&e[s]!==sudoku.BLANK_CHAR?t+=sudoku.BLANK_CHAR:t+=e[s];boards[LEVEL.import]=sudoku.board_string_to_grid(t),show_puzzle(LEVEL.import)})),$(IMPORT_CONTROLS_SEL+" #import-string").keyup((function(){$(this).change()})),$(SOLVER_CONTROLS_SEL+" #solve").click((function(e){e.preventDefault(),solve_puzzle(get_tab())})),$(SOLVER_CONTROLS_SEL+" #get-candidates").click((function(e){e.preventDefault();const t=$(e.target);-1!=t.text().indexOf("Show")?(get_candidates(get_tab()),t.text("Hide candidates")):t.text("Show candidates")})),$(SOLVER_CONTROLS_SEL+" #test-sounds").click((function(e){e.preventDefault(),isAudioPlaying(SOUND.success)&&SOUND.success.stop(),!MUTE&&SOUND.success.play()}))},refresh=()=>{!MUTE&&SOUND.refresh?.play(),FAILED=!1,LABELED=!1,error_counter(0),$(BOARD_SEL+" div.mark").remove(),$(NUMBERS_SEL+" div").removeClass("labeled").removeClass("select");var e=get_tab();e!==LEVEL.import&&show_puzzle(e,!0)},init_message=function(){$(MESSAGE_SEL).hide()},getCss=function(e){var t=window.getComputedStyle(e);return Object.keys(t).reduce((function(e,s){var a=t[s],n=t.getPropertyValue(a);return null!==n&&(e[a]=n),e}),{})},select_all=e=>{},normalization=e=>parseInt((e-50)/850*300+300),check_in=e=>{if(FAILED)return;!MUTE&&SOUND.click.play();let t=$(BOARD_SEL+" .selected"),s=$(e).text();if(t.length){const n=t.first().text(),r=t.first().attr("id").match(/\d+/gi),i=9*parseInt(r[0])+parseInt(r[1]);if(s==n);else if(""==n){const n=t.first();if(LABELED){var a=n.parent().find(".mark");a.length||((a=$('<div class="mark" />')).insertBefore(n),a.on("DOMSubtreeModified",(e=>{marker_change(e)})));const e=a.find(`i:contains('${s}')`);return void(e.length?e.remove():$("<i>"+s+"</i>").appendTo(a))}const{top:r,left:o}=n.offset(),{top:d,left:l}=$(e).offset(),c=$(e).clone(),u=Math.sqrt(Math.pow(d-r,2)+Math.pow(l-o,2)),E=normalization(u),_=parseInt(s)==parseInt(SOLVED[i]);c.addClass("fly-block").appendTo("body").css({left:l+"px",top:d+"px"}).animate({left:o+"px",top:r+"px"},E,(()=>{_?(c.fadeOut(100,(()=>{c.remove()})),n.text(s),n.parent().find(".mark").remove(),check_all_in()):(!MUTE&&SOUND.error?.play(),error_counter(1),c.animate({left:l+"px",top:d+"px"},E,(()=>{c.fadeOut(100,(()=>{c.remove()}))})))}))}else t.removeClass("selected"),$(BOARD_SEL+" div.square").each(((e,t)=>{const a=$(t).text();parseInt(a)==parseInt(s)&&setTimeout((()=>{$(t).addClass("selected")}),50)}))}else $(BOARD_SEL+" div.square").each(((e,t)=>{$(t).text()==s&&$(t).addClass("selected")}))},marker_change=e=>{const t=$(e.target).find("i");$(NUMBERS_SEL+" div.select").removeClass("select"),t.length&&t.each(((e,t)=>{$(NUMBERS_SEL+" div:contains("+t.innerText+")").addClass("select")}))},check_all_in=()=>{0==$(BOARD_SEL+" div.square").filter(((e,t)=>0==t.innerText.length)).length&&0==FAILED&&(SOUND.success?.play(),$("#dialog").modal("show"),$("#dialog .modal-body").html("<div>\n        <p>\n            <img src='./assets/img/success.png' />\n        </p>\n        <h1 class='green-text'>SUCCESS !</h1>\n        </div>"),$("#dialog .modal-footer .btn-primary").click((e=>{refresh(),$("#dialog").modal("hide")})))},solve_puzzle=function(e){if(void 0!==boards[e]){display_puzzle(boards[e],!0);var t=!1;try{var s=sudoku.solve(sudoku.board_grid_to_string(boards[e]))}catch(e){t=!0}s&&!t?(display_puzzle(sudoku.board_string_to_grid(s),!0),$(MESSAGE_SEL).hide()):($(MESSAGE_SEL+" #text").html("<strong>Unable to solve!</strong> Check puzzle and try again."),$(MESSAGE_SEL).show())}},get_candidates=function(e){if(void 0!==boards[e]){display_puzzle(boards[e],!0);var t=!1;try{var s=sudoku.get_candidates(sudoku.board_grid_to_string(boards[e]))}catch(e){t=!0}s&&!t?(display_puzzle(s,!0),$(MESSAGE_SEL).hide()):($(MESSAGE_SEL+" #text").html("<strong>Unable to display candidates!</strong> Contradictions encountered. Check puzzle and try again."),$(MESSAGE_SEL).show())}},show_puzzle=function(e,t){t=t||!1,void 0===boards[e]&&(e=LEVEL.inhuman),(null===boards[e]||t)&&(e===LEVEL.import?boards[e]=sudoku.board_string_to_grid(sudoku.BLANK_BOARD):(SUDOKU=sudoku.generate(e),boards[e]=sudoku.board_string_to_grid(SUDOKU),SOLVED=sudoku.solve(SUDOKU))),display_puzzle(boards[e])},display_puzzle=function(e,t){$(BOARD_SEL+" div.selected").removeClass("selected");for(var s=0;s<9;++s)for(var a=0;a<9;++a){var n=$(BOARD_SEL+" div#row"+s+"-col"+a);if(n.removeClass("green-text"),n.removeAttr("disabled"),e[s][a]!=sudoku.BLANK_CHAR){var r=e[s][a],i=n.text();t&&r!=i&&n.addClass("green-text"),n.text(r)}else n.text("");n.change().click((e=>{number_click($(e.target))}))}},number_click=e=>{if(FAILED)return;!MUTE&&SOUND.click.play();const t=e.text(),s=e.hasClass("selected");if($(BOARD_SEL+" div.selected").removeClass("selected"),s)$(BOARD_SEL+" div.square").each((e=>{}));else if(t)$(BOARD_SEL+" div.square:contains('"+t+"')").addClass("selected");else if(setTimeout((()=>{e.addClass("selected")}),10),$(NUMBERS_SEL+" .select").removeClass("select"),e.siblings(".mark").length>0){e.siblings(".mark").find("i")?.each(((e,t)=>$(NUMBERS_SEL+" div:contains("+t.innerText+")").addClass("select")))}},error_counter=(e=1)=>{let t=$("#error-counter i");if(0==e)return t.remove(),void $(MESSAGE_SEL).hide();t.length+1>3?(FAILED=!0,$("<i>❌</i>").appendTo("#error-counter"),!MUTE&&SOUND.failed?.play(),$(MESSAGE_SEL).show().find("#text").html("<strong>4 This round failed!</strong>")):$("<i>❌</i>").appendTo("#error-counter")},get_tab=function(){return $(TABS_SEL+" li.active a").attr("id")},click_tab=function(e){$(TABS_SEL+" #"+e).click()},SOUND={click:new Audio("./assets/snd/click-6.mp3"),error:new Audio("./assets/snd/error-2.mp3"),failed:new Audio("./assets/snd/game-failed.mp3"),success:new Audio("./assets/snd/game-success.mp3"),invalid:new Audio("./assets/snd/invalid-1.mp3"),notice:new Audio("./assets/snd/notice-1.mp3"),entrance:new Audio("./assets/snd/game-passed.mp3"),newRecord:new Audio("./assets/snd/break-record.mp3"),refresh:new Audio("./assets/snd/click-5.mp3"),labeled:new Audio("./assets/snd/click-3.mp3")},isAudioPlaying=function(e){return e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2},init_sounds=()=>{};$((function(){FAILED=!1,LABELED=!1,init_sounds(),error_counter(0),build_board(),init_board(),init_tabs(),init_controls(),init_message(),$("[rel='tooltip']").tooltip(),click_tab(LEVEL.inhuman),$("#app-wrap").removeClass("hidden"),$("#loading").addClass("hidden")}));